<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji F-Zero</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
        #gameCanvas {
            width: 100%;
            height: 100%;
            background-color: #000;
        }
        #hud {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #fff;
            font-family: Arial, sans-serif;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="hud">
        Energy: <span id="energy">100</span> | Boost: <span id="boost">100</span> | Speed: <span id="speed">0</span>
    </div>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let width, height;

        function resizeCanvas() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        const player = {
            x: 0,
            y: 0,
            speed: 0,
            energy: 100,
            boost: 100,
            isBoosting: false
        };

        const track = {
            width: 2000,
            length: 10000,
            curvature: 0,
            curve: 0
        };

        const camera = {
            x: 0,
            y: 0,
            distToPlayer: 500,
            distToPlane: 100
        };

        const segments = [];
        const segmentLength = 200;
        const roadWidth = 2000;
        const rumbleLength = 3;

        const obstacles = [];
        const opponents = [];

        const sounds = {
            boost: new Audio('https://freesound.org/data/previews/455/455528_8427015-lq.mp3'),
            collision: new Audio('https://freesound.org/data/previews/448/448226_6293289-lq.mp3'),
            pickup: new Audio('https://freesound.org/data/previews/415/415762_5121236-lq.mp3'),
            bgMusic: new Audio('https://freesound.org/data/previews/495/495005_5407806-lq.mp3')
        };

        sounds.bgMusic.loop = true;
        sounds.bgMusic.volume = 0.5;

        function createTrack() {
            for (let i = 0; i < track.length; i += segmentLength) {
                segments.push({
                    index: Math.floor(i / segmentLength),
                    point: i,
                    curve: Math.sin(i * 0.001) * 2,
                    y: Math.sin(i * 0.002) * 1500
                });
            }
        }

        function projectPoint(point, cameraX, cameraY, cameraZ, cameraDepth, width, height) {
            const scale = cameraDepth / (point.z - cameraZ);
            const x = (point.x - cameraX) * scale;
            const y = (point.y - cameraY) * scale;
            return {
                x: Math.round((width / 2) + x * width / 2),
                y: Math.round((height / 2) - y * height / 2),
                w: Math.round(scale * roadWidth * width / 2)
            };
        }

        function drawSegment(ctx, x1, y1, w1, x2, y2, w2, color) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.moveTo(x1 - w1, y1);
            ctx.lineTo(x2 - w2, y2);
            ctx.lineTo(x2 + w2, y2);
            ctx.lineTo(x1 + w1, y1);
            ctx.closePath();
            ctx.fill();
        }

        function drawRoad() {
            const baseSegment = Math.floor(camera.y / segmentLength);
            const playerSegment = Math.floor((camera.y + player.y) / segmentLength);

            for (let n = 0; n < 100; n++) {
                const currentIndex = (baseSegment + n) % segments.length;
                const segment = segments[currentIndex];
                const looped = segment.index < baseSegment;

                const p1 = projectPoint({ x: segment.x, y: segment.y, z: segment.point }, camera.x, camera.y, 0, camera.distToPlane, width, height);
                const p2 = projectPoint({ x: segment.x, y: segment.y, z: segment.point + segmentLength }, camera.x, camera.y, 0, camera.distToPlane, width, height);

                drawSegment(ctx, p1.x, p1.y, p1.w, p2.x, p2.y, p2.w, (segment.index % 2) ? '#4a4a4a' : '#7a7a7a');

                if (segment.index === playerSegment) {
                    ctx.fillStyle = 'ðŸš€';
                    ctx.font = '40px Arial';
                    ctx.fillText('ðŸš€', width / 2, height - 100);
                }
            }
        }

        function updatePlayer() {
            player.speed = player.isBoosting ? Math.min(player.speed + 2, 300) : Math.max(player.speed - 1, 0);
            camera.y += player.speed;

            if (player.isBoosting) {
                player.boost = Math.max(player.boost - 0.5, 0);
                if (player.boost === 0) player.isBoosting = false;
            } else {
                player.boost = Math.min(player.boost + 0.1, 100);
            }
        }

        function updateHUD() {
            document.getElementById('energy').textContent = Math.round(player.energy);
            document.getElementById('boost').textContent = Math.round(player.boost);
            document.getElementById('speed').textContent = Math.round(player.speed);
        }

        function gameLoop() {
            ctx.clearRect(0, 0, width, height);

            updatePlayer();
            drawRoad();
            updateHUD();

            requestAnimationFrame(gameLoop);
        }

        function handleInput(e) {
            switch(e.key) {
                case 'ArrowLeft':
                    player.x = Math.max(player.x - 100, -roadWidth / 2);
                    break;
                case 'ArrowRight':
                    player.x = Math.min(player.x + 100, roadWidth / 2);
                    break;
                case 'ArrowUp':
                    if (player.boost > 0) {
                        player.isBoosting = true;
                        sounds.boost.play();
                    }
                    break;
            }
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            if (touch.clientX < width / 2) {
                player.x = Math.max(player.x - 100, -roadWidth / 2);
            } else {
                player.x = Math.min(player.x + 100, roadWidth / 2);
            }
        }

        function handleTouchEnd() {
            player.isBoosting = false;
        }

        window.addEventListener('keydown', handleInput);
        window.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowUp') {
                player.isBoosting = false;
            }
        });
        window.addEventListener('touchstart', handleTouch);
        window.addEventListener('touchend', handleTouchEnd);

        createTrack();
        sounds.bgMusic.play();
        gameLoop();
    </script>
</body>
</html>